var x=Object.defineProperty;var $=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>($(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();const D="invoice_list",P="item_list",q="itemsTable";class i{}u(i,"APP","app"),u(i,"POPUP_WORK_ITEM_CONTAINER","popupWorkItemContainer"),u(i,"OVERLAY_WORK_ITEM_POPUP","overlayWorkItemPopup"),u(i,"POPUP_WORK_ITEM_CONTAINER_FORM","popupWorkItemContainerForm"),u(i,"BTN_DELETE_WORK_ITEM_POPUP","btnDeleteWorkItemPopup"),u(i,"BTN_CLOSE_WORK_ITEM_POPUP","btnCloseWorkItemPopup"),u(i,"TITLE_WORK_ITEM_CONTAINER","titleWorkItemContainer"),u(i,"INPUT_WORK_ITEM_QTY","inputWorkItemQty"),u(i,"INPUT_WORK_ITEM_COST","inputWorkItemCost"),u(i,"WORK_ITEM_TOTAL_CONTAINER","workItemTotalContainer"),u(i,"BTN_CREATE_WORK_ITEM","btnCreateWorkItem"),u(i,"INPUT_WORK_ITEM_TITLE","inputWorkItemTitle"),u(i,"INPUT_WORK_ITEM_DESCRIPTION","inputWorkItemDescription"),u(i,"INPUT_INVOICE_NUMBER","inputInvoiceNumber"),u(i,"TABLE_WORK_ITEMS","tableWorkItems"),u(i,"BTN_ADD_WORK_ITEM","btnAddWorkItem"),u(i,"RESULTS_SUBTOTAL_CONTAINER","resultsSubtotalContainer"),u(i,"INPUT_DISCOUNT_PERCENT","inputDiscountPercent"),u(i,"RESULTS_DISCOUNT_CONTAINER","resultsDiscountContainer"),u(i,"RESULTS_TOTAL_CONTAINER","resultsTotalContainer"),u(i,"INPUT_IBAN_NUMBER","inputIBANNumber");class R{static createFromTitle({number:t,subtotal:n,discountPercent:s,discountSum:r,total:l,iban:a}){return new R({number:t,subtotal:n,discountPercent:s,discountSum:r,total:l,iban:a})}constructor({number:t,subtotal:n,discountPercent:s,discountSum:r,total:l,iban:a},p=new Date){this.number=t,this.subtotal=n,this.discountPercent=s,this.discountSum=r,this.total=l,this.iban=a,this.date=p}}class y{static createFromTitle(t,n,s,r,l){const a=Date.now().toString();return new y(a,t,n,s,r,l)}constructor(t,n,s,r,l,a,p=new Date){this.id=t,this.title=n,this.description=s,this.qty=r,this.cost=l,this.total=a,this.date=p}}function A(e,t,n){if(!n)throw new Error("Define function must be defined");n(t)?e.disabled=!1:e.disabled=!0}function F(e){return!!(_(e.qty.value)&&_(e.cost.value)&&_(e.title.value)&&_(e.description.value))}function Q(e){return!(!_(e.qty.value)&&!_(e.cost.value)&&!_(e.title.value)&&!_(e.description.value))}function _(e){return!!(typeof e<"u"&&Boolean(e))}function Y(e){const t=typeof e=="string",n=typeof isNaN(parseInt(e)),s=t&&n&&e.length>0;return console.log("> utils -> string: isStringNotNumberAndNoEmpty => result",{result:s,isInputValueString:t,isInputValueNotNumber:n}),s}function W(e,t){const n=C(e),s=U(e,t),r=n&&s;return console.log("> utils -> string: isNumberWithMaxLength => result",{result:r,isInputValueNumber:n,isInputValueWithMaxLength:s}),r}function C(e){return!isNaN(e)}function U(e,t){return e.length<=t}function z(e){const s=String(e).match("/\\n/")===null;return console.log("> utils -> string: isOneLine:",s),s}function H(e){e=String(e),e=e.replace(/\s/g,"");const t=k(e);return console.log("> utils -> string: stylizedIBAN => stylizedValue:",t),t}function k(e){const t=String(e);if(t.length<5)return t;let n=t.slice(0,4);n=n+" ";let s=t.slice(4);return s=k(s),n+s}function f(e,t){localStorage.setItem(e,JSON.stringify(t))}function j(e){localStorage.removeItem(e)}const J=()=>{console.log=(...e)=>{}},o=document.getElementById.bind(document),M=class{static isDomElementMatch(t){return t.dataset.type===M.INPUT_VIEW_ITEM}static createSimpleViewFromVO(t){return`
            <div class="vo" id="${t.id}" style="display: grid; 
            grid-template-columns: repeat(8, 1fr); user-select: none; align-items: center; 
            border-bottom-width: 1px; padding-top: 0.5rem; padding-bottom: 0.5rem; 
            :hover { background-color: rgb(243 244 246); }">
                <div style="grid-column-start: 1; grid-column: span 4; align-self: end;
                padding-left: 2px; padding-right: 3px">
                    <div style="font-weight: 700">${t.title.title}</div>
                    <div style="font-size: 0.75rem; line-height: 1rem; 
                    color: rgb(156 163 175);">${t.title.description}</div>
                </div>
                <div style="grid-column-start: 5">${t.title.cost}</div>
                <div style="grid-column-start: 6">${t.title.qty}</div>
                <div style="grid-column: span 2 / span 2; 
                text-align: right; padding-right: 2px">${t.title.total}</div>
            </div>
        `}};let O=M;u(O,"INPUT_VIEW_ITEM","inputitem");const G="invoice",X="items";function N(e,t){if(console.log(`> ServerService -> ${t}: response.data =`,e),e.ok===!1)throw new Error(`ServerService - ${t}: error(${e.statusText})`);return e.json()}class Z{constructor(t){console.log("> ServerService -> constructor",t),this.url=t}get invoicePath(){return`${this.url}/${G}`}get itemsPath(){return`${this.url}/${X}`}async saveInvoice(t){const n=this.invoicePath;return await this.save(t,n,"invoice")}async requestItems(){const t=this.itemsPath;return await this.request(t,"tableOfItems")}async saveItems(t){const n=this.itemsPath;return await this.save(t,n,"tableOfItems")}async updateItems(t,n){const s=`${this.itemsPath}/${n}`;return await this.update(t,s,"tableOfItems")}async deleteItems(t){const n=`${this.itemsPath}/${t}`;return await this.delete(n,"tableOfItems")}async request(t,n){console.log(`> ServerService -> request: ${n}`);try{const s=await fetch(t,{method:"GET"}).then(r=>N(r,"request"));return console.log(`> ServerService -> request: ${n} =`,s),s}catch(s){throw console.log(`> ServerService -> request: error = ${s}`),s}}async save(t,n,s){return console.log(`> ServerService -> save: ${s}`,t),fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(r=>N(r,"save")).catch(r=>{throw console.log(`> ServerService -> save: error = ${r}`),r})}async update(t,n,s){return console.log(`> ServerService -> update: ${s}`,t),fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(r=>N(r,"update")).catch(r=>{throw console.log(`> ServerService -> update: error = ${r}`),r})}async delete(t,n){return console.log(`> ServerService -> delete: ${n}`),fetch(t,{method:"DELETE"}).then(s=>N(s,"delete")).catch(s=>{throw console.log("> ServerService -> delete: error = ${error}"),s})}}class K{constructor(t,n){console.log("> FormService -> constructor",t,n),this.inputs=t,this.containers=n}get invoiceDiscountSum(){return this.invoiceSubtotal*(this.inputs.discount.value/100)}get invoiceTotal(){return this.invoiceSubtotal*(1-this.inputs.discount.value/100)}get itemTotal(){return this.inputs.qty.value*this.inputs.cost.value}setInvoiceSubtotal(t){let n=0;for(let s of t){let r=s.title.total;r=Number(r),n=n+r}this.invoiceSubtotal=n,console.log("> FormService -> setInvoiceSubtotal:",n)}setInvoiceContainers(){console.log(`> FormService -> setInvoiceContainers: ${this.invoiceSubtotal}, ${this.invoiceDiscountSum}, ${this.invoiceTotal}`),this.containers.subtotal.innerText=this.invoiceSubtotal,this.containers.discount.innerText=this.invoiceDiscountSum,this.containers.total.innerText=this.invoiceTotal}setItemContainer(){this.containers.total.innerText=this.itemTotal,console.log("> FormService -> setItemContainer:",this.containers.total.innerText)}setItem(t){this.inputs.qty.value=t.title.qty,this.inputs.cost.value=t.title.cost,this.inputs.title.value=t.title.title,this.inputs.description.value=t.title.description}getInvoiceList(){let t={number:this.inputs.number.value,discount:this.inputs.discount.value,iban:this.inputs.iban.value},n={subtotal:this.containers.subtotal.innerText,discount:this.containers.discount.innerText,total:this.containers.discount.innerText};const s={inputsValues:t,containersTexts:n};return console.log("> FormService -> getInvoiceList:",s),s}getItemList(){let t={qty:this.inputs.qty.value,cost:this.inputs.cost.value,title:this.inputs.title.value,description:this.inputs.description.value},n={total:this.containers.total.innerText};const s={inputsValues:t,containersTexts:n};return console.log("> FormService -> getItemList:",s),s}getItem(t){return t.title.qty=this.inputs.qty.value,t.title.cost=this.inputs.cost.value,t.title.total=this.containers.total.innerText,t.title.title=this.inputs.title.value,t.title.description=this.inputs.description.value,t}clearItemForm(){this.inputs.qty.value="",this.inputs.cost.value="",this.inputs.title.value="",this.inputs.description.value=""}}class tt{constructor(t){console.log("> InputService -> constructor",t),this.checkMethod=t}setInput(t){this.input=t}validateInput(t=null,n=null){return this.check()?typeof t=="function"?!!this.validate(t,n):!0:!1}check(){return!!this.checkMethod(this.input.value)}validate(t,n){return!!t(this.input.value,n)}reset(){this.input.value=""}}o(i.BTN_DELETE_WORK_ITEM_POPUP).addEventListener("click",It);o(i.OVERLAY_WORK_ITEM_POPUP).addEventListener("click",Tt);o(i.BTN_CLOSE_WORK_ITEM_POPUP).addEventListener("click",V);o(i.INPUT_WORK_ITEM_QTY).addEventListener("keyup",dt);o(i.INPUT_WORK_ITEM_COST).addEventListener("keyup",_t);o(i.BTN_CREATE_WORK_ITEM).addEventListener("click",pt);o(i.INPUT_WORK_ITEM_TITLE).addEventListener("keyup",Et);o(i.INPUT_WORK_ITEM_DESCRIPTION).addEventListener("keyup",vt);o(i.INPUT_INVOICE_NUMBER).addEventListener("keyup",ot);o(i.TABLE_WORK_ITEMS).addEventListener("click",ct);o(i.BTN_ADD_WORK_ITEM).addEventListener("click",rt);o(i.INPUT_DISCOUNT_PERCENT).addEventListener("keyup",lt);o(i.INPUT_IBAN_NUMBER).addEventListener("keyup",ut);let d={},T=null,E=null;const v=new Z("http://localhost:3003"),B=e=>d.find(t=>t.id===e);J();v.requestItems().then(e=>{console.log("> Initial env:",{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}),console.log("> Initial value:",e),d=e,h(),g(d,o(i.TABLE_WORK_ITEMS))}).catch(e=>{o(i.APP).innerHTML=`
      <div id="errorOnInit">
        <h1>Problem with server</h1>
        <p style="color:red">${e.toString()}</p>
      </div>`}).finally(()=>o(i.APP).style.visibility="visible");const et={number:o(i.INPUT_INVOICE_NUMBER),discount:o(i.INPUT_DISCOUNT_PERCENT),iban:o(i.INPUT_IBAN_NUMBER)},it={subtotal:o(i.RESULTS_SUBTOTAL_CONTAINER),discount:o(i.RESULTS_DISCOUNT_CONTAINER),total:o(i.RESULTS_TOTAL_CONTAINER)},m=new K(et,it),nt={qty:o(i.INPUT_WORK_ITEM_QTY),cost:o(i.INPUT_WORK_ITEM_COST),title:o(i.INPUT_WORK_ITEM_TITLE),description:o(i.INPUT_WORK_ITEM_DESCRIPTION)},st={total:o(i.WORK_ITEM_TOTAL_CONTAINER)},I=new K(nt,st),c=new tt(Y);async function ot(){c.setInput(o(i.INPUT_INVOICE_NUMBER)),console.log("> keyupInvoiceNumber:",c.input.value),c.validateInput(W,4)?await L():(c.reset(),alert("Keyup error: is not string, number, empty or longer than max length"))}async function rt(){o(i.BTN_DELETE_WORK_ITEM_POPUP).disabled=!0,o(i.BTN_CREATE_WORK_ITEM).disabled=!0,o(i.TITLE_WORK_ITEM_CONTAINER).innerText="Add",E="Create",o(i.BTN_CREATE_WORK_ITEM).innerText="Create",o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!1}async function ct(){o(i.TITLE_WORK_ITEM_CONTAINER).innerText="Update",E="Add",o(i.BTN_CREATE_WORK_ITEM).innerText="Add",o(i.BTN_CREATE_WORK_ITEM).disabled=!1,o(i.BTN_CREATE_WORK_ITEM).disabled=!0;const t=event.target.closest(".vo");T=B(t.id),I.setItem(T),console.log("> clickItem:",t,T),o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!1}async function lt(){c.setInput(o(i.INPUT_DISCOUNT_PERCENT)),console.log("> keyupDiscountPercent:",c.input.value),c.validateInput(W,2)?(h(),await L()):c.reset()}async function ut(){c.setInput(o(i.INPUT_IBAN_NUMBER)),console.log("> keyupIBANNumber:",c.input.value),c.validateInput(U,30)?(c.input.value=H(c.input.value),L()):c.reset()}function h(){m.setInvoiceSubtotal(d),m.setInvoiceContainers()}function at(){const e=m.getInvoiceList(),t=e.inputsValues.number,n=e.containersTexts.subtotal,s=e.inputsValues.discount,r=e.containersTexts.discount,l=e.containersTexts.total,a=e.inputsValues.iban,p=R.createFromTitle({number:t,subtotal:n,discountPercent:s,discountSum:r,total:l,iban:a});return console.log("> create_Invoice -> invoice =",p),p}function L(){const e=at();v.saveInvoice(e).then(n=>{console.log("> save_Invoice: saved =",n)}).catch(alert);const t=m.getInvoiceList();f(D,t)}function g(e,t){let n="",s;for(let r in e)s=e[r],n+=O.createSimpleViewFromVO(s);t.innerHTML=n,console.log("> render_ItemTableInContainer:",e),f(q,e)}function It(){const e=T.id;console.log("> onBtnDeleteWorkItemPopupClick -> itemId:",e);const t=B(e);confirm("Delete the work item?")&&v.deleteItems(e).then(()=>{d.splice(d.indexOf(t),1),b(),o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!0,g(d,o(i.TABLE_WORK_ITEMS)),h()})}function V(){o(i.BTN_CREATE_WORK_ITEM).disabled===!1&&!confirm("Close the work item?")||(o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!0)}function Tt(){V()}async function dt(){c.setInput(o(i.INPUT_WORK_ITEM_QTY)),console.log("> keyupQty:",c.input.value),S(C),w()}function _t(){c.setInput(o(i.INPUT_WORK_ITEM_COST)),console.log("> keyupCost:",c.input.value),S(C),w()}function pt(){E==="Create"?Nt():E==="Add"&&Ot()}function Et(){c.setInput(o(i.INPUT_WORK_ITEM_TITLE)),console.log("> keyupTitle:",c.input.value),S(z)}function vt(){c.setInput(o(i.INPUT_WORK_ITEM_DESCRIPTION)),console.log("> keyupDescription:",c.input.value),S()}function S(e=c.checkMethod,t=o(i.BTN_CREATE_WORK_ITEM)){c.validateInput(e)||c.reset(),E==="Create"?A(t,I.inputs,F):E==="Add"&&A(t,I.inputs,Q),console.log("> disabledItem: createBtn.disabled =",t.disabled)}function w(){I.setItemContainer()}function ht(){const e=I.getItemList(),t=e.inputsValues.title,n=e.inputsValues.description,s=e.inputsValues.qty,r=e.inputsValues.cost,l=e.containersTexts.total,a=y.createFromTitle({title:t,description:n,qty:s,cost:r,total:l});return console.log("> create_Item -> item =",a),a}function Nt(){const e=ht();v.saveItems(e).then(()=>{b(),o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!0,h(),g(d,o(i.TABLE_WORK_ITEMS))});const t=I.getItemList();f(P,t)}function Ot(){T=I.getItem(T),console.log("> update_Item:",T),v.updateItems(T,T.id).then(()=>{b(),o(i.POPUP_WORK_ITEM_CONTAINER).hidden=!0,h(),g(d,o(i.TABLE_WORK_ITEMS))});const e=I.getItemList();f(P,e)}function b(){I.clearItemForm(),I.getItemList(),j(P)}
