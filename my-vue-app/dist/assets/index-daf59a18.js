var $=Object.defineProperty;var q=(e,t,i)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var a=(e,t,i)=>(q(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function i(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerpolicy&&(l.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?l.credentials="include":r.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=i(r);fetch(r.href,l)}})();const D="invoice_list",S="item_list",F="itemsTable";class n{}a(n,"APP","app"),a(n,"POPUP_WORK_ITEM_CONTAINER","popupWorkItemContainer"),a(n,"OVERLAY_WORK_ITEM_POPUP","overlayWorkItemPopup"),a(n,"POPUP_WORK_ITEM_CONTAINER_FORM","popupWorkItemContainerForm"),a(n,"BTN_DELETE_WORK_ITEM_POPUP","btnDeleteWorkItemPopup"),a(n,"BTN_CLOSE_WORK_ITEM_POPUP","btnCloseWorkItemPopup"),a(n,"TITLE_WORK_ITEM_CONTAINER","titleWorkItemContainer"),a(n,"INPUT_WORK_ITEM_QTY","inputWorkItemQty"),a(n,"INPUT_WORK_ITEM_COST","inputWorkItemCost"),a(n,"WORK_ITEM_TOTAL_CONTAINER","workItemTotalContainer"),a(n,"BTN_CREATE_WORK_ITEM","btnCreateWorkItem"),a(n,"INPUT_WORK_ITEM_TITLE","inputWorkItemTitle"),a(n,"INPUT_WORK_ITEM_DESCRIPTION","inputWorkItemDescription"),a(n,"INPUT_INVOICE_NUMBER","inputInvoiceNumber"),a(n,"TABLE_WORK_ITEMS","tableWorkItems"),a(n,"BTN_ADD_WORK_ITEM","btnAddWorkItem"),a(n,"RESULTS_SUBTOTAL_CONTAINER","resultsSubtotalContainer"),a(n,"INPUT_DISCOUNT_PERCENT","inputDiscountPercent"),a(n,"RESULTS_DISCOUNT_CONTAINER","resultsDiscountContainer"),a(n,"RESULTS_TOTAL_CONTAINER","resultsTotalContainer"),a(n,"INPUT_IBAN_NUMBER","inputIBANNumber");class P{static createFromTitle({number:t,subtotal:i,discountPercent:o,discountSum:r,total:l,iban:u}){const d=Date.now().toString();return new P(d,{number:t,subtotal:i,discountPercent:o,discountSum:r,total:l,iban:u})}constructor(t,{number:i,subtotal:o,discountPercent:r,discountSum:l,total:u,iban:d},x=new Date){this.id=t,this.number=i,this.subtotal=o,this.discountPercent=r,this.discountSum=l,this.total=u,this.iban=d,this.date=x}}class R{static createFromTitle(t,i,o,r,l){const u=Date.now().toString();return new R(u,t,i,o,r,l)}constructor(t,i,o,r,l,u,d=new Date){this.id=t,this.title=i,this.description=o,this.qty=r,this.cost=l,this.total=u,this.date=d}}function U(e,t,i){if(!i)throw new Error("Define function must be defined");i(t)?e.disabled=!1:e.disabled=!0}function Q(e){return!!(_(e.qty.value)&&_(e.cost.value)&&_(e.title.value)&&_(e.description.value))}function Y(e){return!(!_(e.qty.value)&&!_(e.cost.value)&&!_(e.title.value)&&!_(e.description.value))}function _(e){return!!(typeof e<"u"&&Boolean(e))}function z(e){const t=typeof e=="string",i=typeof isNaN(parseInt(e)),o=t&&i&&e.length>0;return console.log("> utils -> string: isStringNotNumberAndNoEmpty => result",{result:o,isInputValueString:t,isInputValueNotNumber:i}),o}function W(e,t){const i=y(e),o=A(e,t),r=i&&o;return console.log("> utils -> string: isNumberWithMaxLength => result",{result:r,isInputValueNumber:i,isInputValueWithMaxLength:o}),r}function y(e){return!isNaN(e)}function A(e,t){return e.length<=t}function H(e){const o=String(e).match("/\\n/")===null;return console.log("> utils -> string: isOneLine:",o),o}function j(e){e=String(e),e=e.replace(/\s/g,"");const t=k(e);return console.log("> utils -> string: stylizedIBAN => stylizedValue:",t),t}function k(e){const t=String(e);if(t.length<5)return t;let i=t.slice(0,4);i=i+" ";let o=t.slice(4);return o=k(o),i+o}function f(e,t){localStorage.setItem(e,JSON.stringify(t))}function J(e){localStorage.removeItem(e)}const G=()=>{console.log=(...e)=>{}},s=document.getElementById.bind(document),M=class{static isDomElementMatch(t){return t.dataset.type===M.INPUT_VIEW_ITEM}static createSimpleViewFromVO(t){return`
            <div class="vo" id="${t.id}" style="display: grid; 
            grid-template-columns: repeat(8, 1fr); user-select: none; align-items: center; 
            border-bottom-width: 1px; padding-top: 0.5rem; padding-bottom: 0.5rem; 
            :hover { background-color: rgb(243 244 246); }">
                <div style="grid-column-start: 1; grid-column: span 4; align-self: end;
                padding-left: 2px; padding-right: 3px">
                    <div style="font-weight: 700">${t.title.title}</div>
                    <div style="font-size: 0.75rem; line-height: 1rem; 
                    color: rgb(156 163 175);">${t.title.description}</div>
                </div>
                <div style="grid-column-start: 5">${t.title.cost}</div>
                <div style="grid-column-start: 6">${t.title.qty}</div>
                <div style="grid-column: span 2 / span 2; 
                text-align: right; padding-right: 2px">${t.title.total}</div>
            </div>
        `}};let O=M;a(O,"INPUT_VIEW_ITEM","inputitem");const X="invoice",Z="items";function N(e,t){if(console.log(`> ServerService -> ${t}: response.data =`,e),e.ok===!1)throw new Error(`ServerService - ${t}: error(${e.statusText})`);return e.json()}class tt{constructor(t){console.log("> ServerService -> constructor",t),this.url=t}get invoicePath(){return`${this.url}/${X}`}get itemsPath(){return`${this.url}/${Z}`}async requestInvoice(){const t=this.invoicePath;return await this.request(t,"invoice")}async saveInvoice(t){const i=this.invoicePath;return await this.save(t,i,"invoice")}async requestItems(){const t=this.itemsPath;return await this.request(t,"tableOfItems")}async saveItems(t){const i=this.itemsPath;return await this.save(t,i,"tableOfItems")}async updateItems(t,i){const o=`${this.itemsPath}/${i}`;return await this.update(t,o,"tableOfItems")}async deleteItems(t){const i=`${this.itemsPath}/${t}`;return await this.delete(i,"tableOfItems")}async request(t,i){console.log(`> ServerService -> request: ${i}`);try{const o=await fetch(t,{method:"GET"}).then(r=>N(r,"request"));return console.log(`> ServerService -> request: ${i} =`,o),o}catch(o){throw console.log(`> ServerService -> request: error = ${o}`),o}}async save(t,i,o){return console.log(`> ServerService -> save: ${o}`,t),fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(r=>N(r,"save")).catch(r=>{throw console.log(`> ServerService -> save: error = ${r}`),r})}async update(t,i,o){return console.log(`> ServerService -> update: ${o}`,t),fetch(i,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(r=>N(r,"update")).catch(r=>{throw console.log(`> ServerService -> update: error = ${r}`),r})}async delete(t,i){return console.log(`> ServerService -> delete: ${i}`),fetch(t,{method:"DELETE"}).then(o=>N(o,"delete")).catch(o=>{throw console.log("> ServerService -> delete: error = ${error}"),o})}}class K{constructor(t,i){console.log("> FormService -> constructor",t,i),this.inputs=t,this.containers=i}get invoiceDiscountSum(){return this.invoiceSubtotal*(this.inputs.discount.value/100)}get invoiceTotal(){return this.invoiceSubtotal*(1-this.inputs.discount.value/100)}get itemTotal(){return this.inputs.qty.value*this.inputs.cost.value}setInvoiceSubtotal(t){let i=0;for(let o of t){let r=o.title.total;r=Number(r),i=i+r}this.invoiceSubtotal=i,console.log("> FormService -> setInvoiceSubtotal:",i)}setInvoiceContainers(){console.log(`> FormService -> setInvoiceContainers: ${this.invoiceSubtotal}, ${this.invoiceDiscountSum}, ${this.invoiceTotal}`),this.containers.subtotal.innerText=this.invoiceSubtotal,this.containers.discount.innerText=this.invoiceDiscountSum,this.containers.total.innerText=this.invoiceTotal}setItemContainer(){this.containers.total.innerText=this.itemTotal,console.log("> FormService -> setItemContainer:",this.containers.total.innerText)}setItem(t){this.inputs.qty.value=t.title.qty,this.inputs.cost.value=t.title.cost,this.inputs.title.value=t.title.title,this.inputs.description.value=t.title.description}getInvoiceList(){let t={number:this.inputs.number.value,discount:this.inputs.discount.value,iban:this.inputs.iban.value},i={subtotal:this.containers.subtotal.innerText,discount:this.containers.discount.innerText,total:this.containers.discount.innerText};const o={inputsValues:t,containersTexts:i};return console.log("> FormService -> getInvoiceList:",o),o}getItemList(){let t={qty:this.inputs.qty.value,cost:this.inputs.cost.value,title:this.inputs.title.value,description:this.inputs.description.value},i={total:this.containers.total.innerText};const o={inputsValues:t,containersTexts:i};return console.log("> FormService -> getItemList:",o),o}getItem(t){return t.title.qty=this.inputs.qty.value,t.title.cost=this.inputs.cost.value,t.title.total=this.containers.total.innerText,t.title.title=this.inputs.title.value,t.title.description=this.inputs.description.value,t}clearItemForm(){this.inputs.qty.value="",this.inputs.cost.value="",this.inputs.title.value="",this.inputs.description.value=""}}class et{constructor(t){console.log("> InputService -> constructor",t),this.checkMethod=t}setInput(t){this.input=t}validateInput(t=null,i=null){return this.check()?typeof t=="function"?!!this.validate(t,i):!0:!1}check(){return!!this.checkMethod(this.input.value)}validate(t,i){return!!t(this.input.value,i)}reset(){this.input.value=""}}s(n.BTN_DELETE_WORK_ITEM_POPUP).addEventListener("click",dt);s(n.OVERLAY_WORK_ITEM_POPUP).addEventListener("click",_t);s(n.BTN_CLOSE_WORK_ITEM_POPUP).addEventListener("click",V);s(n.INPUT_WORK_ITEM_QTY).addEventListener("keyup",pt);s(n.INPUT_WORK_ITEM_COST).addEventListener("keyup",vt);s(n.BTN_CREATE_WORK_ITEM).addEventListener("click",Et);s(n.INPUT_WORK_ITEM_TITLE).addEventListener("keyup",ht);s(n.INPUT_WORK_ITEM_DESCRIPTION).addEventListener("keyup",Nt);s(n.INPUT_INVOICE_NUMBER).addEventListener("keyup",rt);s(n.TABLE_WORK_ITEMS).addEventListener("click",lt);s(n.BTN_ADD_WORK_ITEM).addEventListener("click",ct);s(n.INPUT_DISCOUNT_PERCENT).addEventListener("keyup",at);s(n.INPUT_IBAN_NUMBER).addEventListener("keyup",ut);let p={},T=null,v=null;const E=new tt("http://localhost:3003"),B=e=>p.find(t=>t.id===e);G();E.requestInvoice().then(e=>{console.log("> Initial value:",e),Tt(e)});E.requestItems().then(e=>{console.log("> Initial env:",{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0}),console.log("> Initial value:",e),p=e,h(),L(p,s(n.TABLE_WORK_ITEMS))}).catch(e=>{s(n.APP).innerHTML=`
      <div id="errorOnInit">
        <h1>Problem with server</h1>
        <p style="color:red">${e.toString()}</p>
      </div>`}).finally(()=>s(n.APP).style.visibility="visible");const it={number:s(n.INPUT_INVOICE_NUMBER),discount:s(n.INPUT_DISCOUNT_PERCENT),iban:s(n.INPUT_IBAN_NUMBER)},nt={subtotal:s(n.RESULTS_SUBTOTAL_CONTAINER),discount:s(n.RESULTS_DISCOUNT_CONTAINER),total:s(n.RESULTS_TOTAL_CONTAINER)},m=new K(it,nt),st={qty:s(n.INPUT_WORK_ITEM_QTY),cost:s(n.INPUT_WORK_ITEM_COST),title:s(n.INPUT_WORK_ITEM_TITLE),description:s(n.INPUT_WORK_ITEM_DESCRIPTION)},ot={total:s(n.WORK_ITEM_TOTAL_CONTAINER)},I=new K(st,ot),c=new et(z);async function rt(){c.setInput(s(n.INPUT_INVOICE_NUMBER)),console.log("> keyupInvoiceNumber:",c.input.value),c.validateInput(W,4)?await C():(c.reset(),alert("Keyup error: is not string, number, empty or longer than max length"))}async function ct(){s(n.BTN_DELETE_WORK_ITEM_POPUP).disabled=!0,s(n.BTN_CREATE_WORK_ITEM).disabled=!0,s(n.TITLE_WORK_ITEM_CONTAINER).innerText="Add",v="Create",s(n.BTN_CREATE_WORK_ITEM).innerText="Create",s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!1}async function lt(){s(n.TITLE_WORK_ITEM_CONTAINER).innerText="Update",v="Save",s(n.BTN_CREATE_WORK_ITEM).innerText="Save",s(n.BTN_CREATE_WORK_ITEM).disabled=!1,s(n.BTN_CREATE_WORK_ITEM).disabled=!0;const t=event.target.closest(".vo");T=B(t.id),I.setItem(T),console.log("> clickItem:",t,T),s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!1}async function at(){c.setInput(s(n.INPUT_DISCOUNT_PERCENT)),console.log("> keyupDiscountPercent:",c.input.value),c.validateInput(W,2)?(h(),await C()):c.reset()}async function ut(){c.setInput(s(n.INPUT_IBAN_NUMBER)),console.log("> keyupIBANNumber:",c.input.value),c.validateInput(A,30)?(c.input.value=j(c.input.value),C()):c.reset()}function h(){m.setInvoiceSubtotal(p),m.setInvoiceContainers()}function It(){const e=m.getInvoiceList(),t=e.inputsValues.number,i=e.containersTexts.subtotal,o=e.inputsValues.discount,r=e.containersTexts.discount,l=e.containersTexts.total,u=e.inputsValues.iban,d=P.createFromTitle({number:t,subtotal:i,discountPercent:o,discountSum:r,total:l,iban:u});return console.log("> create_Invoice -> invoice =",d),d}function C(){const e=It();E.saveInvoice(e).then(i=>{console.log("> save_Invoice: saved =",i)}).catch(alert);const t=m.getInvoiceList();f(D,t)}function Tt(e){const t=e.length-1,i=e[t];s(n.INPUT_INVOICE_NUMBER).value=i.number,s(n.INPUT_DISCOUNT_PERCENT).value=i.discountPercent,s(n.INPUT_IBAN_NUMBER).value=i.iban}function L(e,t){let i="",o;for(let r in e)o=e[r],i+=O.createSimpleViewFromVO(o);t.innerHTML=i,console.log("> render_ItemTableInContainer:",e),f(F,e)}function dt(){const e=T.id;console.log("> onBtnDeleteWorkItemPopupClick -> itemId:",e);const t=B(e);confirm("Delete the work item?")&&E.deleteItems(e).then(()=>{p.splice(p.indexOf(t),1),b(),s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!0,L(p,s(n.TABLE_WORK_ITEMS)),h()})}function V(){s(n.BTN_CREATE_WORK_ITEM).disabled===!1&&!confirm("Close the work item?")||(s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!0)}function _t(){V()}async function pt(){c.setInput(s(n.INPUT_WORK_ITEM_QTY)),console.log("> keyupQty:",c.input.value),g(y),w()}function vt(){c.setInput(s(n.INPUT_WORK_ITEM_COST)),console.log("> keyupCost:",c.input.value),g(y),w()}function Et(){v==="Create"?mt():v==="Save"&&ft()}function ht(){c.setInput(s(n.INPUT_WORK_ITEM_TITLE)),console.log("> keyupTitle:",c.input.value),g(H)}function Nt(){c.setInput(s(n.INPUT_WORK_ITEM_DESCRIPTION)),console.log("> keyupDescription:",c.input.value),g()}function g(e=c.checkMethod,t=s(n.BTN_CREATE_WORK_ITEM)){c.validateInput(e)||c.reset(),v==="Create"?U(t,I.inputs,Q):v==="Save"&&U(t,I.inputs,Y),console.log("> disabledItem: createBtn.disabled =",t.disabled)}function w(){I.setItemContainer()}function Ot(){const e=I.getItemList(),t=e.inputsValues.title,i=e.inputsValues.description,o=e.inputsValues.qty,r=e.inputsValues.cost,l=e.containersTexts.total,u=R.createFromTitle({title:t,description:i,qty:o,cost:r,total:l});return console.log("> create_Item -> item =",u),u}function mt(){const e=Ot();E.saveItems(e).then(()=>{b(),s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!0,h(),location.reload()});const t=I.getItemList();f(S,t)}function ft(){T=I.getItem(T),console.log("> update_Item:",T),E.updateItems(T,T.id).then(()=>{b(),s(n.POPUP_WORK_ITEM_CONTAINER).hidden=!0,h(),L(p,s(n.TABLE_WORK_ITEMS))});const e=I.getItemList();f(S,e)}function b(){I.clearItemForm(),I.getItemList(),J(S)}
